var data={};function tempSymbols(e){var t={"t͡ʂ":"T","d͡ʐ":"D","j̃":"J","w̃":"W","t̪":"T","d̪":"D","ʦ̪":"C","ʣ̪":"Q",pf:"P"};return e=e.replace(/t͡ʂ|d͡ʐ|j̃|w̃|t̪|d̪|ʦ̪|ʣ̪|pf/gi,function(e){return t[e]})}function identifyCluster(e){var t,s=0,n=0,a=0;for(var d=0,r=(e=tempSymbols(e)).length;d<r;d++){if(!segments.segments[e[d]])return"contains illegal characters";if(t=e[d],segments.segments[t].isVowel)if(0===d)n+=1;else{if(!(d=e.length))return"not a cluster";a+=1}else s+=1}return 0===e.length?"no cluster specified":1===n&&1===a?s<2?"not a cluster":2===s?"VCCV":3===s?"VCCCV":"cluster too big":1===n&&0===a?s<2?"not a cluster":2===s?"VCC":3===s?"VCCC":"cluster too big":0===n&&1===a?s<2?"not a cluster":2===s?"CCV":3===s?"CCCV":"cluster too big":"position of vowel(s) not specified"}function calculateNAD(e){var t=identifyCluster(e=tempSymbols(e)),s=$("#include-sonority").is(":checked");function n(e,t){return d(e,t)}function a(e,t){return d(e,t)}function d(e,t){var n;return n=0==e.poa||0==t.poa?Math.abs(e.moa-t.moa):Math.abs(e.moa-t.moa)+Math.abs(e.poa-t.poa),s&&e.son!==t.son&&(n+=1),n}function r(e){return Math.round(100*(e+1e-5))/100}var l=0,m=0,o=0,i=0,g="-",c="-";switch(t){case"CCV":return c=(l=n(segments.segments[e[0]],segments.segments[e[1]]))-(o=a(segments.segments[e[1]],segments.segments[e[2]])),g=l>=o?"Yes":"No","<td>-</td><td>"+r(l)+"</td><td>-</td><td>"+r(o)+"</td><td>"+r(c)+"</td><td class='nad'>"+g+"</td>";case"VCC":return c=(l=n(segments.segments[e[1]],segments.segments[e[2]]))-(i=a(segments.segments[e[0]],segments.segments[e[1]])),g=l>=i?"Yes":"No","<td>"+r(i)+"</td><td>"+r(l)+"</td><td>-</td><td>-</td><td>"+r(c)+"</td><td class='nad'>"+g+"</td>";case"VCCV":return i=a(segments.segments[e[0]],segments.segments[e[1]]),o=a(segments.segments[e[2]],segments.segments[e[3]]),c=(i-(l=n(segments.segments[e[1]],segments.segments[e[2]]))+(o-l))/2,g=i>=l&&l<o&&l>0?"Yes":"No","<td>"+r(i)+"</td><td>"+r(l)+"</td><td>-</td><td>"+r(o)+"</td><td>"+r(c)+"</td><td class='nad'>"+g+"</td>";case"CCCV":return l=n(segments.segments[e[0]],segments.segments[e[1]]),c=((m=n(segments.segments[e[1]],segments.segments[e[2]]))-l+(m-(o=a(segments.segments[e[2]],segments.segments[e[3]]))))/2,g=l<m&&m>=o?"Yes":"No","<td>-</td><td>"+r(l)+"</td><td>"+r(m)+"</td><td>"+r(o)+"</td><td>"+r(c)+"</td><td class='nad'>"+g+"</td>";case"VCCC":return l=n(segments.segments[e[1]],segments.segments[e[2]]),m=n(segments.segments[e[2]],segments.segments[e[3]]),c=(l-(i=a(segments.segments[e[0]],segments.segments[e[1]]))+(l-m))/2,g=i<=l&&l>m?"Yes":"No","<td>"+r(i)+"</td><td>"+r(l)+"</td><td>"+r(m)+"</td><td>-</td><td>"+r(c)+"</td><td class='nad'>"+g+"</td>";case"VCCCV":l=n(segments.segments[e[1]],segments.segments[e[2]]),m=n(segments.segments[e[2]],segments.segments[e[3]]),i=a(segments.segments[e[0]],segments.segments[e[1]]),o=a(segments.segments[e[3]],segments.segments[e[4]]),g=i>=l&&m<o?"Yes":"No";var u=c;return"<td>"+r(i)+"</td><td>"+r(l)+"</td><td>"+r(m)+"</td><td>"+r(o)+"</td><td>"+u+"</td><td class='nad'>"+g+"</td>";default:return"-"}}function modifyNAD(){var e=$(this).attr("id"),t=$(this).val();if("moa"==$(this).attr("class")){var s=$(this).parent().parent().children().index($(this).parent());$(this).parent().parent().parent().children("tr").each(function(){$(this).find("button:not(.empty)").each(function(e,n){if($(this).parent().parent().children().index($(this).parent())===s){var a=tempSymbols(a=$(this).html());segments.segments[a].moa=t}})})}else if("poa"==$(this).attr("class")){s=$(this).parent().parent().parent().children().index($(this).parent().parent());$(this).parent().parent().parent().children("tr").each(function(){$(this).find("button:not(.empty,.labiovelar)").each(function(n,a){if($(this).parent().parent().parent().children().index($(this).parent().parent())===s){var d=tempSymbols(d=$(this).html());if("bilabialNAD"===e||"velarNAD"===e||"moaNAD15"===e){segments.segments[d].poa=t;var r=parseFloat($("#bilabialNAD").val(),10)+parseFloat($("#velarNAD").val(),10),l=parseFloat($("#moaNAD15").val(),10)+parseFloat($("#velarNAD").val(),10);segments.segments.w.poa=r/2,"pl"===$("#db").val()?segments.segments.W.poa=r/2:"custom"===$("#db").val()?segments.segments["ʍ"].poa=r/2:"eng-new"===$("#db").val()&&(segments.segments.u.poa=l/2)}else segments.segments[d].poa=t}})})}}$(document).ready(function(){$("#keyboard-placeholder").load("db/eng-new.html"),segments=(segments=null,$.ajax({async:!1,global:!1,url:"db/eng-new.json",dataType:"json",success:function(e){segments=e}}),segments)}),$("#db").change(function(){var e=$("#db").val();$("#keyboard-placeholder").load("db/"+e+".html"),segments=(segments=null,$.ajax({async:!1,global:!1,url:"db/"+e+".json",dataType:"json",success:function(e){segments=e}}),console.log(segments),segments)}),$("#target").click(function(){$("#result table tbody").html("");var e=$("#clusters").val().split("\n");$.each(e,function(){$("#result table tbody").append("<tr><td>"+this+"</td><td>"+identifyCluster(this)+"</td>"+calculateNAD(this)+"<tr>")}),$("#result table .nad").each(function(){var e=$(this),t=e.text();if("Yes"===t)e.parent().addClass("success");else{if("No"!==t)return!1;e.parent().addClass("error")}})}),$("#remove").click(function(){$("#clusters").val("")}),$("#clear-table").click(function(){$("#result table tbody").html("")}),$("body").on("keypress","input[type=number]",function(e){46==e.which&&-1==$(this).val().indexOf(".")||!(e.which<48||e.which>57)?46==e.which&&0==$(this).val().length?e.preventDefault():-1!=$(this).val().indexOf(".")&&$(this).val().substring($(this).val().indexOf("."),$(this).val().indexOf(".").length).length>1&&e.preventDefault():e.preventDefault()}),$("body").on("change","input[type=number]",function(){$.proxy(modifyNAD,$(this))()});var customNADloaded=0;$("#clusters").change(function(){"custom"===$("#db").val()&&0===customNADloaded&&($("input[type=number]").each(function(){$.proxy(modifyNAD,$(this))()}),customNADloaded=1)});