var data={};function tempSymbols(t){var e={"t͡ʂ":"T","d͡ʐ":"D","j̃":"J","w̃":"W","t̪":"T","d̪":"D","ʦ̪":"C","ʣ̪":"Q",pf:"P"};return t=t.replace(/t͡ʂ|d͡ʐ|j̃|w̃|t̪|d̪|ʦ̪|ʣ̪|pf/gi,function(t){return e[t]})}function identifyCluster(t){var e,s=0,n=0,a=0;for(var d=0,r=(t=tempSymbols(t)).length;d<r;d++){if(!segments.segments[t[d]])return"contains illegal characters";if(e=t[d],segments.segments[e].isVowel)if(0===d)n+=1;else{if(!(d=t.length))return"not a cluster";a+=1}else s+=1}return 0===t.length?"no cluster specified":1===n&&1===a?s<2?"not a cluster":2===s?"VCCV":3===s?"VCCCV":"cluster too big":1===n&&0===a?s<2?"not a cluster":2===s?"VCC":3===s?"VCCC":"cluster too big":0===n&&1===a?s<2?"not a cluster":2===s?"CCV":3===s?"CCCV":"cluster too big":"position of vowel(s) not specified"}function calculateNAD(t){function e(t,e){return $("#include-sonority").is(":checked")&&t.son!==e.son?Math.abs(t.moa-e.moa)+Math.abs(t.poa-e.poa)+1:Math.abs(t.moa-e.moa)+Math.abs(t.poa-e.poa)}function s(t,e){return $("#include-sonority").is(":checked")&&t.son!==e.son?Math.abs(t.moa-e.moa)+1:Math.abs(t.moa-e.moa)}function n(t){return Math.round(100*(t+1e-5))/100}t=tempSymbols(t);var a=0,d=0,r=0,m=0,o="-",i="-";switch(identifyCluster(t)){case"CCV":return i=(a=e(segments.segments[t[0]],segments.segments[t[1]]))-(r=s(segments.segments[t[1]],segments.segments[t[2]])),o=a>=r?"Yes":"No","<td>-</td><td>"+n(a)+"</td><td>-</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCC":return i=(a=e(segments.segments[t[1]],segments.segments[t[2]]))-(m=s(segments.segments[t[0]],segments.segments[t[1]])),o=a>=m?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>-</td><td>-</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCCV":return m=s(segments.segments[t[0]],segments.segments[t[1]]),r=s(segments.segments[t[2]],segments.segments[t[3]]),i=(m-(a=e(segments.segments[t[1]],segments.segments[t[2]]))+(r-a))/2,o=m>=a&&a<r&&a>0?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>-</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"CCCV":return a=e(segments.segments[t[0]],segments.segments[t[1]]),i=((d=e(segments.segments[t[1]],segments.segments[t[2]]))-a+(d-(r=s(segments.segments[t[2]],segments.segments[t[3]]))))/2,o=a<d&&d>=r?"Yes":"No","<td>-</td><td>"+n(a)+"</td><td>"+n(d)+"</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCCC":return a=e(segments.segments[t[1]],segments.segments[t[2]]),d=e(segments.segments[t[2]],segments.segments[t[3]]),i=(a-(m=s(segments.segments[t[0]],segments.segments[t[1]]))+(a-d))/2,o=m<=a&&a>d?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>"+n(d)+"</td><td>-</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCCCV":return a=e(segments.segments[t[1]],segments.segments[t[2]]),d=e(segments.segments[t[2]],segments.segments[t[3]]),m=s(segments.segments[t[0]],segments.segments[t[1]]),r=s(segments.segments[t[3]],segments.segments[t[4]]),o=m>=a&&d<r?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>"+n(d)+"</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";default:return"-"}}function modifyNAD(){var t=$(this).attr("id"),e=$(this).val();if("moa"==$(this).attr("class")){var s=$(this).parent().parent().children().index($(this).parent());$(this).parent().parent().parent().children("tr").each(function(){$(this).find("button:not(.empty)").each(function(t,n){if($(this).parent().parent().children().index($(this).parent())===s){var a=$(this).html();a=tempSymbols(a);segments.segments[a].moa=e}})})}else if("poa"==$(this).attr("class")){s=$(this).parent().parent().parent().children().index($(this).parent().parent());$(this).parent().parent().parent().children("tr").each(function(){$(this).find("button:not(.empty,.labiovelar)").each(function(n,a){if($(this).parent().parent().parent().children().index($(this).parent().parent())===s){var d=$(this).html();d=tempSymbols(d);if("bilabialNAD"===t||"velarNAD"===t){segments.segments[d].poa=e;var r=parseFloat($("#bilabialNAD").val(),10)+parseFloat($("#velarNAD").val(),10);segments.segments.w.poa=r/2,"pl"===$("#db").val()?segments.segments.W.poa=r/2:"custom"===$("#db").val()&&(segments.segments["ʍ"].poa=r/2)}else segments.segments[d].poa=e}})})}}$(document).ready(function(){$("#keyboard-placeholder").load("db/eng.html"),segments=(segments=null,$.ajax({async:!1,global:!1,url:"db/eng.json",dataType:"json",success:function(t){segments=t}}),segments)}),$("#db").change(function(){var t=$("#db").val();$("#keyboard-placeholder").load("db/"+t+".html"),segments=(segments=null,$.ajax({async:!1,global:!1,url:"db/"+t+".json",dataType:"json",success:function(t){segments=t}}),console.log(segments),segments)}),$("#target").click(function(){$("#result table tbody").html("");var t=$("#clusters").val().split("\n");$.each(t,function(){$("#result table tbody").append("<tr><td>"+this+"</td><td>"+identifyCluster(this)+"</td>"+calculateNAD(this)+"<tr>")}),$("#result table .nad").each(function(){var t=$(this),e=t.text();if("Yes"===e)t.parent().addClass("success");else{if("No"!==e)return!1;t.parent().addClass("error")}})}),$("#remove").click(function(){$("#clusters").val("")}),$("#clear-table").click(function(){$("#result table tbody").html("")}),$("body").on("keypress","input[type=number]",function(t){46==t.which&&-1==$(this).val().indexOf(".")||!(t.which<48||t.which>57)?46==t.which&&0==$(this).val().length?t.preventDefault():-1!=$(this).val().indexOf(".")&&$(this).val().substring($(this).val().indexOf("."),$(this).val().indexOf(".").length).length>1&&t.preventDefault():t.preventDefault()}),$("body").on("change","input[type=number]",function(){$.proxy(modifyNAD,$(this))()});var customNADloaded=0;$("#clusters").change(function(){"custom"===$("#db").val()&&0===customNADloaded&&($("input[type=number]").each(function(){$.proxy(modifyNAD,$(this))()}),customNADloaded=1)});data={};function tempSymbols(t){var e={"t͡ʂ":"T","d͡ʐ":"D","j̃":"J","w̃":"W","t̪":"T","d̪":"D","ʦ̪":"C","ʣ̪":"Q",pf:"P"};return t=t.replace(/t͡ʂ|d͡ʐ|j̃|w̃|t̪|d̪|ʦ̪|ʣ̪|pf/gi,function(t){return e[t]})}function identifyCluster(t){var e,s=0,n=0,a=0;for(var d=0,r=(t=tempSymbols(t)).length;d<r;d++){if(!segments.segments[t[d]])return"contains illegal characters";if(e=t[d],segments.segments[e].isVowel)if(0===d)n+=1;else{if(!(d=t.length))return"not a cluster";a+=1}else s+=1}return 0===t.length?"no cluster specified":1===n&&1===a?s<2?"not a cluster":2===s?"VCCV":3===s?"VCCCV":"cluster too big":1===n&&0===a?s<2?"not a cluster":2===s?"VCC":3===s?"VCCC":"cluster too big":0===n&&1===a?s<2?"not a cluster":2===s?"CCV":3===s?"CCCV":"cluster too big":"position of vowel(s) not specified"}function calculateNAD(t){function e(t,e){return $("#include-sonority").is(":checked")&&t.son!==e.son?Math.abs(t.moa-e.moa)+Math.abs(t.poa-e.poa)+1:Math.abs(t.moa-e.moa)+Math.abs(t.poa-e.poa)}function s(t,e){return $("#include-sonority").is(":checked")&&t.son!==e.son?Math.abs(t.moa-e.moa)+1:Math.abs(t.moa-e.moa)}function n(t){return Math.round(100*(t+1e-5))/100}t=tempSymbols(t);var a=0,d=0,r=0,m=0,o="-",i="-";switch(identifyCluster(t)){case"CCV":return i=(a=e(segments.segments[t[0]],segments.segments[t[1]]))-(r=s(segments.segments[t[1]],segments.segments[t[2]])),o=a>=r?"Yes":"No","<td>-</td><td>"+n(a)+"</td><td>-</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCC":return i=(a=e(segments.segments[t[1]],segments.segments[t[2]]))-(m=s(segments.segments[t[0]],segments.segments[t[1]])),o=a>=m?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>-</td><td>-</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCCV":return m=s(segments.segments[t[0]],segments.segments[t[1]]),r=s(segments.segments[t[2]],segments.segments[t[3]]),i=(m-(a=e(segments.segments[t[1]],segments.segments[t[2]]))+(r-a))/2,o=m>=a&&a<r&&a>0?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>-</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"CCCV":return a=e(segments.segments[t[0]],segments.segments[t[1]]),i=((d=e(segments.segments[t[1]],segments.segments[t[2]]))-a+(d-(r=s(segments.segments[t[2]],segments.segments[t[3]]))))/2,o=a<d&&d>=r?"Yes":"No","<td>-</td><td>"+n(a)+"</td><td>"+n(d)+"</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCCC":return a=e(segments.segments[t[1]],segments.segments[t[2]]),d=e(segments.segments[t[2]],segments.segments[t[3]]),i=(a-(m=s(segments.segments[t[0]],segments.segments[t[1]]))+(a-d))/2,o=m<=a&&a>d?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>"+n(d)+"</td><td>-</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";case"VCCCV":return a=e(segments.segments[t[1]],segments.segments[t[2]]),d=e(segments.segments[t[2]],segments.segments[t[3]]),m=s(segments.segments[t[0]],segments.segments[t[1]]),r=s(segments.segments[t[3]],segments.segments[t[4]]),o=m>=a&&d<r?"Yes":"No","<td>"+n(m)+"</td><td>"+n(a)+"</td><td>"+n(d)+"</td><td>"+n(r)+"</td><td>"+n(i)+"</td><td class='nad'>"+o+"</td>";default:return"-"}}function modifyNAD(){var t=$(this).attr("id"),e=$(this).val();if("moa"==$(this).attr("class")){var s=$(this).parent().parent().children().index($(this).parent());$(this).parent().parent().parent().children("tr").each(function(){$(this).find("button:not(.empty)").each(function(t,n){if($(this).parent().parent().children().index($(this).parent())===s){var a=$(this).html();a=tempSymbols(a);segments.segments[a].moa=e}})})}else if("poa"==$(this).attr("class")){s=$(this).parent().parent().parent().children().index($(this).parent().parent());$(this).parent().parent().parent().children("tr").each(function(){$(this).find("button:not(.empty,.labiovelar)").each(function(n,a){if($(this).parent().parent().parent().children().index($(this).parent().parent())===s){var d=$(this).html();d=tempSymbols(d);if("bilabialNAD"===t||"velarNAD"===t){segments.segments[d].poa=e;var r=parseFloat($("#bilabialNAD").val(),10)+parseFloat($("#velarNAD").val(),10);segments.segments.w.poa=r/2,"pl"===$("#db").val()?segments.segments.W.poa=r/2:"custom"===$("#db").val()&&(segments.segments["ʍ"].poa=r/2)}else segments.segments[d].poa=e}})})}}$(document).ready(function(){$("#keyboard-placeholder").load("db/eng.html"),segments=(segments=null,$.ajax({async:!1,global:!1,url:"db/eng.json",dataType:"json",success:function(t){segments=t}}),segments)}),$("#db").change(function(){var t=$("#db").val();$("#keyboard-placeholder").load("db/"+t+".html"),segments=(segments=null,$.ajax({async:!1,global:!1,url:"db/"+t+".json",dataType:"json",success:function(t){segments=t}}),console.log(segments),segments)}),$("#target").click(function(){$("#result table tbody").html("");var t=$("#clusters").val().split("\n");$.each(t,function(){$("#result table tbody").append("<tr><td>"+this+"</td><td>"+identifyCluster(this)+"</td>"+calculateNAD(this)+"<tr>")}),$("#result table .nad").each(function(){var t=$(this),e=t.text();if("Yes"===e)t.parent().addClass("success");else{if("No"!==e)return!1;t.parent().addClass("error")}})}),$("#remove").click(function(){$("#clusters").val("")}),$("#clear-table").click(function(){$("#result table tbody").html("")}),$("body").on("keypress","input[type=number]",function(t){46==t.which&&-1==$(this).val().indexOf(".")||!(t.which<48||t.which>57)?46==t.which&&0==$(this).val().length?t.preventDefault():-1!=$(this).val().indexOf(".")&&$(this).val().substring($(this).val().indexOf("."),$(this).val().indexOf(".").length).length>1&&t.preventDefault():t.preventDefault()}),$("body").on("change","input[type=number]",function(){$.proxy(modifyNAD,$(this))()});customNADloaded=0;$("#clusters").change(function(){"custom"===$("#db").val()&&0===customNADloaded&&($("input[type=number]").each(function(){$.proxy(modifyNAD,$(this))()}),customNADloaded=1)});